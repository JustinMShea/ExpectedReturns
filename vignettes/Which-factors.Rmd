---
title: '"Which Factors? q-factor and traditional models"'
subtitle: "(draft)"
author: "Vito Lestingi"
date: "`r Sys.Date()`"
abstract: "This document includes replication material on some academic and practitioners' literature instrumental for our RGSoC 2020 project. The document itself is meant to be completely reproducible."
output:
  rmarkdown::pdf_document:
  citation_package: biblatex
bibliography: references.bib
vignette: >
  %\VignetteIndexEntry{"Which Factors? q-factor and traditional models"}
  %\VignetteEngine{rmarkdown::render}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_knit$set(
  root.dir = normalizePath('..')
)
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  echo = TRUE,
  warning = FALSE,
  error = FALSE
)
```

# Introduction
These notes aim at reproducing several works on factors modeling and their comparisons. The framework is the one adopted by \textcite{hou-al-2018}, who systematically examine how seemingly different factor models are related among each other. In particular, their approach is focused on comparing their contributed q-factor models against an assorted set of emblematic models from various strains of the asset pricing literature, on both conceptual and empirical grounds.
These benchmark (fundamental) factor models include "standard" ones as the Fama-French five-factor model \parencite{fama-french-2015} and the Fama-French six-factor model \parencite{fama-french-2018}, models methodologically divergent from the Fama-French approach such as \textcite{stambaugh-yuan-2017} and \textcite{daniel-hirshleifer-sun-2020}, and also the "hybrid" model of \textcite{barillas-shanken-2018}. At the time of writing, we are focusing on analyses involving q-factor models and "traditional" models, that is the Fama-French models. This given latter authors' pioneering work in the field and their models widespread use as the de facto benchmarks in the broader literature.
In what follows we first of all introduce target models and their theoretical grounds, then proceed with spanning regressions for their statistical comparison and performance assessments.

# Data and methodology
Authors make available data for factors returns analyzed in their research at [global-q.org](http://global-q.org/index.html). Importantly, data sets are open-sourced and updated regularly. Similarly to the well known Fama-French academic library, data series they provide span several frequencies including daily, weekly (calendar, Friday close to Friday close), weekly (Wednesday-to-Wednesday, Wednesday close to Wednesday close), monthly, quarterly, and annual.

```{r Load data sets}
data(
  list=c(
    'FF5.monthly', 'FF6.monthly', 
    'Q4.monthly', 'Q5.monthly', 
    'SY4.monthly'
  )
)
```

It should be noted that there exist small nuances between the risk-free interest rates (one month T-Bill, `RF`) downloadable from French's website and those one can obtain from [global-q.org](http://global-q.org/index.html). These differences do not seem to be due to import conversions or numerical rounding, they may come directly from the source. 
In our context, they propagate to the market proxy factor (`MKT.RF`) and thus if anything we are forced to keep the two separate although they shall be conceptually the same depending on the assets universe considered.

# Q-factor models
Their *q-factor model* is inspired by the investment-based approach to the asset pricing theory.

## q-factor model 
In this section we first of all summarize research and the model introduced by \textcite{hou-al-2015}, then aim at reproducing it. It consists of four factors: the market factor ($MKT$), a size factor ($ME$), an investment factor ($I/A$), and a profitability factor ($ROE$). 
The factor regressions specification used to assess the q-factor model performance is 
$$
r_{i,t} - r_{f, t} = {\alpha}_{i,q} + {\beta}_{MKT,i}{MKT}_{t} + {\beta}_{ME,i}r_{ME,t} + {\beta}_{I/A,i}r_{I/A,t} + {\beta}_{ROE,i}r_{ROE,t} + {\epsilon}_{i,t}
$$
where, as usual, $r_{i,t} - r_{f, t}$ stands for the returns on excess of the risk-free rate.
Authors find their model to largely capture the cross section of average stock returns.

## $q^5$ factor model
In this section we first of all summarize research and the model introduced by \textcite{hou-al-2020}, then aim at reproducing it. 
This model is an extension of the previous four-factor q model in that it additionally includes the *expected growth* factor, $EG$.
The factor regressions specification used to assess the $q^5$-factor model performance is then 
$$
r_{i,t} - r_{f, t} = {\alpha}_{i,q} + {\beta}_{MKT,i}{MKT}_{t} + {\beta}_{ME,i}r_{ME,t} + {\beta}_{I/A,i}r_{I/A,t} + {\beta}_{ROE,i}r_{ROE,t} + {\beta}_{EG,i}r_{EG,t} + {\epsilon}_{i,t}
$$
# Benchmark models

## Fama-French five-factor model
The *Fama-French five-factor model* was introduced by \textcite{fama-french-2015}. In this model Fama and French include the RMW (Robust Minus Weak) and CMA (Conservative Minus Aggressive) to their standard \textcite{fama-french-1993} three-factor model. Factors are constructed using the six value-weight portfolios formed on size, the six value-weight portfolios formed on size and operating profitability, and the six value-weight portfolios formed on size and investment.

## Fama-French six-factor model
The *Fama-French six-factor model* is by \textcite{fama-french-2018}. It builds on the just discussed *Fama-French five-factor model* and adds the MOM momentum factor, which is also commonly referred to as Up Minus Down (UMD).
At this time we are unable to study the "alternative Fama-French six-factor model", which has the RMWc factor in place of the RMW factor, because authors apparently dismissed its publication. Readers willing to study this model would thus need to construct it themselves.

# Models empirical comparisons
In this section, closely following authors, we run spanning regressions in order to compare the q-factor models across the set of benchmarks model considered.

```{r SpanningRegressions utility function}
SpanningRegressions <- function(Y, X, ...) {
  Yn <- rep(Y, each=length(X)) 
  X <- rep(X, length(Y))
  # Models regressions
  fits <- mapply(
    function(y, x) {
      mod <- formula(
        paste(y, paste(x, collapse='+'), sep='~')
      )
      fit <- lm(mod, ...)
      return(fit)
    },
    as.list(Yn), X,
    SIMPLIFY=FALSE
  )
  # Newey-West t-statistics
  nwts <- lapply(fits, function(x) {
    lmtest::coeftest(x, vcov.=sandwich::NeweyWest(x, ...), ...)
  })
  # TODO: names overlap, workaround or longer names
  # Naming by regressand
  # names(fits) <- paste(Yn, 'reg', sep='.')
  # names(nwts) <- paste(Yn, 'nwts', sep='.')
  return(list(fits=fits, nwts=nwts))
}
```

```{r Table 1 Q factors vs Fama French}
q4.vars <- c('MKT.RF.1', 'ME', 'IA', 'ROE')
q5.vars <- c(q4.vars, 'EG')
ff5.vars <- c('MKT.RF', 'SMB', 'HML', 'RMW', 'CMA')
ff6.vars <- c(ff5.vars, 'MOM')
data.qff <- merge(FF6.monthly, Q5.monthly)
data.qff <- data.qff[complete.cases(data.qff), c(ff6.vars, q5.vars)]

# Panel A: Explaining q and q5 factors
q.on.ff <- SpanningRegressions(q5.vars, list(ff5.vars, ff6.vars), data=data.qff)
lapply(q.on.ff$fits, summary)

# Panel B: Explaining Fama–French factors
ff.on.q <- SpanningRegressions(ff6.vars, list(q4.vars, q5.vars), data=data.qff)
lapply(ff.on.q$fits, summary)
```

```{r Table 2 Q factors vs Stambaugh Yuan 4 Factors}
sy4.vars <- c('MKT.RF', 'SMB', 'MGMT', 'PERF')
data.qsy <- merge(SY4.monthly, Q5.monthly)
data.qsy <- data.qsy[complete.cases(data.qsy), c(q5.vars, sy4.vars)]

# Panel A: Explaining q and q5 factors
q.on.sy <- SpanningRegressions(q5.vars, list(sy4.vars), data=data.qsy)
lapply(q.on.sy$fits, summary)

# Panel B: Explaining the Stambaugh–Yuan factors
sy.on.q <- SpanningRegressions(sy4.vars, list(q4.vars, q5.vars), data=data.qsy)
lapply(sy.on.q$fits, summary)
```
